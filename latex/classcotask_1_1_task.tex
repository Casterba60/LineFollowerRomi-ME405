\doxysection{Task Class Reference}
\hypertarget{classcotask_1_1_task}{}\label{classcotask_1_1_task}\index{Task@{Task}}


Implements multitasking with scheduling and some performance logging.  


\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classcotask_1_1_task_a9c7e20ac92efc057ba6df6851adc45ba}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, run\+\_\+fun, \mbox{\hyperlink{classcotask_1_1_task_ab74e6bf80237ddc4109968cedc58c151}{name}}="{}No\+Name"{}, \mbox{\hyperlink{classcotask_1_1_task_a6a5183df4c54c3e28dc8dc704f2487d5}{priority}}=0, period=None, profile=False, trace=False, shares=())
\begin{DoxyCompactList}\small\item\em Initialize a task object so it may be run by the scheduler. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classcotask_1_1_task_a2ac9e615bfff6001c329e7cbaf58a84e}{schedule}} (self)
\begin{DoxyCompactList}\small\item\em This method is called by the scheduler; it attempts to run this task. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classcotask_1_1_task_a1f36066ff61a2a42154caf5fb827b52a}{ready}} (self)
\begin{DoxyCompactList}\small\item\em This method checks if the task is ready to run. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classcotask_1_1_task_aabadc1d997c668994c8a8ed5783d3501}{set\+\_\+period}} (self, new\+\_\+period)
\begin{DoxyCompactList}\small\item\em This method sets the period between runs of the task to the given number of milliseconds, or {\ttfamily None} if the task is triggered by calls to {\ttfamily \doxylink{classcotask_1_1_task_aed457c4e809216b219f54ededf51b6e1}{go()}} rather than time. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classcotask_1_1_task_ad987a9aa9be0eecd1723fb065783291a}{reset\+\_\+profile}} (self)
\begin{DoxyCompactList}\small\item\em This method resets the variables used for execution time profiling. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classcotask_1_1_task_a4b801e8c8ae5db1cf070033ce5611484}{get\+\_\+trace}} (self)
\begin{DoxyCompactList}\small\item\em This method returns a string containing the task\textquotesingle{}s transition trace. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classcotask_1_1_task_aed457c4e809216b219f54ededf51b6e1}{go}} (self)
\begin{DoxyCompactList}\small\item\em Method to set a flag so that this task indicates that it\textquotesingle{}s ready to run. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classcotask_1_1_task_a61a1f3a6a4df93d491cd753f617782a2}{\+\_\+\+\_\+repr\+\_\+\+\_\+}} (self)
\begin{DoxyCompactList}\small\item\em This method converts the task to a string for diagnostic use. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Data Fields}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classcotask_1_1_task_ab74e6bf80237ddc4109968cedc58c151}\label{classcotask_1_1_task_ab74e6bf80237ddc4109968cedc58c151} 
{\bfseries name} = name
\begin{DoxyCompactList}\small\item\em The name of the task, hopefully a short and descriptive string. \end{DoxyCompactList}\item 
\Hypertarget{classcotask_1_1_task_a6a5183df4c54c3e28dc8dc704f2487d5}\label{classcotask_1_1_task_a6a5183df4c54c3e28dc8dc704f2487d5} 
{\bfseries priority} = int(priority)
\begin{DoxyCompactList}\small\item\em The task\textquotesingle{}s priority, an integer with higher numbers meaning higher priority. \end{DoxyCompactList}\item 
\Hypertarget{classcotask_1_1_task_a486233493fc0e05fe1bdbe7b7e5d0f1e}\label{classcotask_1_1_task_a486233493fc0e05fe1bdbe7b7e5d0f1e} 
int {\bfseries period} = int(period \texorpdfstring{$\ast$}{*} 1000)
\item 
\Hypertarget{classcotask_1_1_task_af74518b510641596f925fa194c4a8ee1}\label{classcotask_1_1_task_af74518b510641596f925fa194c4a8ee1} 
bool {\bfseries go\+\_\+flag} = False
\begin{DoxyCompactList}\small\item\em Flag which is set true when the task is ready to be run by the scheduler. \end{DoxyCompactList}\item 
\Hypertarget{classcotask_1_1_task_acb1fa057f260c6964ec6f85ba010d52c}\label{classcotask_1_1_task_acb1fa057f260c6964ec6f85ba010d52c} 
int {\bfseries \+\_\+prof} = 1
\item 
\Hypertarget{classcotask_1_1_task_a38a60b320f2e19594a5a99004203cf07}\label{classcotask_1_1_task_a38a60b320f2e19594a5a99004203cf07} 
int {\bfseries \+\_\+trace} = self.\+\_\+prev\+\_\+state\+:
\item 
\Hypertarget{classcotask_1_1_task_ac9bb45b08a5730ffdf26f8495fafa7e1}\label{classcotask_1_1_task_ac9bb45b08a5730ffdf26f8495fafa7e1} 
str {\bfseries \+\_\+trace} = \textquotesingle{}\textbackslash{}n\textquotesingle{}
\item 
\Hypertarget{classcotask_1_1_task_a5676de6ac5bc6db7759a6013d256afbf}\label{classcotask_1_1_task_a5676de6ac5bc6db7759a6013d256afbf} 
float {\bfseries \+\_\+tr\+\_\+data} = item\mbox{[}0\mbox{]} / 1000000.\+0
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classcotask_1_1_task_a7fabb2137f175dfd7bbc221927db62ce}\label{classcotask_1_1_task_a7fabb2137f175dfd7bbc221927db62ce} 
{\bfseries \+\_\+run\+\_\+gen} = run\+\_\+fun(shares)
\item 
\Hypertarget{classcotask_1_1_task_a23e03bc1a339ec26880fd15fd49fea5b}\label{classcotask_1_1_task_a23e03bc1a339ec26880fd15fd49fea5b} 
{\bfseries \+\_\+next\+\_\+run} = utime.\+ticks\+\_\+us() + self.\+period
\item 
\Hypertarget{classcotask_1_1_task_a81274332cf5e2ba361679492953ba925}\label{classcotask_1_1_task_a81274332cf5e2ba361679492953ba925} 
{\bfseries \+\_\+prof} = profile
\item 
\Hypertarget{classcotask_1_1_task_a986935908f8383bedb244f505aa5e24e}\label{classcotask_1_1_task_a986935908f8383bedb244f505aa5e24e} 
int {\bfseries \+\_\+prev\+\_\+state} = 0
\item 
\Hypertarget{classcotask_1_1_task_ac59040d717c63c58f7539a990b5b55b9}\label{classcotask_1_1_task_ac59040d717c63c58f7539a990b5b55b9} 
bool {\bfseries \+\_\+trace} = trace
\item 
\Hypertarget{classcotask_1_1_task_a09edea18585d4a31daa46f03832203be}\label{classcotask_1_1_task_a09edea18585d4a31daa46f03832203be} 
list {\bfseries \+\_\+tr\+\_\+data} = \mbox{[}$\,$\mbox{]}
\item 
\Hypertarget{classcotask_1_1_task_a48148be0d8985ea402e3b4957177af6e}\label{classcotask_1_1_task_a48148be0d8985ea402e3b4957177af6e} 
{\bfseries \+\_\+prev\+\_\+time} = utime.\+ticks\+\_\+us()
\item 
\Hypertarget{classcotask_1_1_task_ab786d5ad7c162c7c19ef15eb609b86ba}\label{classcotask_1_1_task_ab786d5ad7c162c7c19ef15eb609b86ba} 
int {\bfseries \+\_\+slowest}
\item 
\Hypertarget{classcotask_1_1_task_a04e35e92b2df829c545fe9c009d9f98a}\label{classcotask_1_1_task_a04e35e92b2df829c545fe9c009d9f98a} 
int {\bfseries \+\_\+latest}
\item 
\Hypertarget{classcotask_1_1_task_ae13e55c956e8eafb028b10fe4f97595c}\label{classcotask_1_1_task_ae13e55c956e8eafb028b10fe4f97595c} 
int {\bfseries \+\_\+runs} = 0
\item 
\Hypertarget{classcotask_1_1_task_a04f0e5a16919dd716b876b7ff521cda7}\label{classcotask_1_1_task_a04f0e5a16919dd716b876b7ff521cda7} 
int {\bfseries \+\_\+run\+\_\+sum} = 0
\item 
\Hypertarget{classcotask_1_1_task_a6002faaa800d1e8c0196166726dfeda4}\label{classcotask_1_1_task_a6002faaa800d1e8c0196166726dfeda4} 
int {\bfseries \+\_\+late\+\_\+sum} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implements multitasking with scheduling and some performance logging. 

This class implements behavior common to tasks in a cooperative multitasking system which runs in Micro\+Python. The ability to be scheduled on the basis of time or an external software trigger or interrupt is implemented, state transitions can be recorded, and run times can be profiled. The user\textquotesingle{}s task code must be implemented in a generator which yields the state (and the CPU) after it has run for a short and bounded period of time.

{\bfseries{Example\+:}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{def\ }task1\_fun\ ():}
\DoxyCodeLine{\ \ \ \ \ \textcolor{stringliteral}{'''!\ This\ function\ switches\ states\ repeatedly\ for\ no\ reason\ '''}}
\DoxyCodeLine{\ \ \ \ \ state\ =\ 0}
\DoxyCodeLine{\ \ \ \ \ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ state\ ==\ 0:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ state\ =\ 1}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ state\ ==\ 1:}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ state\ =\ 0}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ (state)}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{\#\ In\ main\ routine,\ create\ this\ task\ and\ set\ it\ to\ run\ twice\ per\ second}}
\DoxyCodeLine{\ task1\ =\ \mbox{\hyperlink{classcotask_1_1_task}{cotask.Task}}\ (task1\_fun,\ name\ =\ \textcolor{stringliteral}{'Task\ 1'},\ priority\ =\ 1,\ }
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ period\ =\ 500,\ profile\ =\ \textcolor{keyword}{True},\ trace\ =\ \textcolor{keyword}{True})}
\DoxyCodeLine{}
\DoxyCodeLine{\ \textcolor{comment}{\#\ Add\ the\ task\ to\ the\ list\ (so\ it\ will\ be\ run)\ and\ run\ scheduler}}
\DoxyCodeLine{\ cotask.task\_list.append\ (task1)}
\DoxyCodeLine{\ \textcolor{keywordflow}{while}\ \textcolor{keyword}{True}:\ }
\DoxyCodeLine{\ \ \ \ \ cotask.task\_list.pri\_sched\ ()}

\end{DoxyCode}
 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classcotask_1_1_task_a9c7e20ac92efc057ba6df6851adc45ba}\index{Task@{Task}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_a9c7e20ac92efc057ba6df6851adc45ba} 
\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{run\+\_\+fun}{, }\item[{}]{name}{ = {\ttfamily "{}NoName"{}}, }\item[{}]{priority}{ = {\ttfamily 0}, }\item[{}]{period}{ = {\ttfamily None}, }\item[{}]{profile}{ = {\ttfamily False}, }\item[{}]{trace}{ = {\ttfamily False}, }\item[{}]{shares}{ = {\ttfamily ()}}\end{DoxyParamCaption})}



Initialize a task object so it may be run by the scheduler. 

This method initializes a task object, saving copies of constructor parameters and preparing an empty dictionary for states.


\begin{DoxyParams}{Parameters}
{\em run\+\_\+fun} & The function which implements the task\textquotesingle{}s code. It must be a generator which yields the current state. \\
\hline
{\em name} & The name of the task, by default {\ttfamily No\+Name}. This should be overridden with a more descriptive name by the programmer. \\
\hline
{\em priority} & The priority of the task, a positive integer with higher numbers meaning higher priority (default 0) \\
\hline
{\em period} & The time in milliseconds between runs of the task if it\textquotesingle{}s run by a timer or {\ttfamily None} if the task is not run by a timer. The time can be given in a {\ttfamily float} or {\ttfamily int}; it will be converted to microseconds for internal use by the scheduler. \\
\hline
{\em profile} & Set to {\ttfamily True} to enable run-\/time profiling \\
\hline
{\em trace} & Set to {\ttfamily True} to generate a list of transitions between states. {\bfseries{Note\+:}} This slows things down and allocates memory. \\
\hline
{\em shares} & A list or tuple of shares and queues used by this task. If no list is given, no shares are passed to the task \\
\hline
\end{DoxyParams}


\doxysubsection{Member Function Documentation}
\Hypertarget{classcotask_1_1_task_a61a1f3a6a4df93d491cd753f617782a2}\index{Task@{Task}!\_\_repr\_\_@{\_\_repr\_\_}}
\index{\_\_repr\_\_@{\_\_repr\_\_}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{\_\_repr\_\_()}{\_\_repr\_\_()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_a61a1f3a6a4df93d491cd753f617782a2} 
\+\_\+\+\_\+repr\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



This method converts the task to a string for diagnostic use. 

It shows information about the task, including execution time profiling results if profiling has been done. \begin{DoxyReturn}{Returns}
The string which represents the task 
\end{DoxyReturn}
\Hypertarget{classcotask_1_1_task_a4b801e8c8ae5db1cf070033ce5611484}\index{Task@{Task}!get\_trace@{get\_trace}}
\index{get\_trace@{get\_trace}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{get\_trace()}{get\_trace()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_a4b801e8c8ae5db1cf070033ce5611484} 
get\+\_\+trace (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



This method returns a string containing the task\textquotesingle{}s transition trace. 

The trace is a set of tuples, each of which contains a time and the states from and to which the system transitioned. \begin{DoxyReturn}{Returns}
A possibly quite large string showing state transitions 
\end{DoxyReturn}
\Hypertarget{classcotask_1_1_task_aed457c4e809216b219f54ededf51b6e1}\index{Task@{Task}!go@{go}}
\index{go@{go}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{go()}{go()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_aed457c4e809216b219f54ededf51b6e1} 
go (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



Method to set a flag so that this task indicates that it\textquotesingle{}s ready to run. 

This method may be called from an interrupt service routine or from another task which has data that this task needs to process soon. \Hypertarget{classcotask_1_1_task_a1f36066ff61a2a42154caf5fb827b52a}\index{Task@{Task}!ready@{ready}}
\index{ready@{ready}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{ready()}{ready()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_a1f36066ff61a2a42154caf5fb827b52a} 
 bool ready (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



This method checks if the task is ready to run. 

If the task runs on a timer, this method checks what time it is; if not, this method checks the flag which indicates that the task is ready to go. This method may be overridden in descendent classes to implement some other behavior. \Hypertarget{classcotask_1_1_task_ad987a9aa9be0eecd1723fb065783291a}\index{Task@{Task}!reset\_profile@{reset\_profile}}
\index{reset\_profile@{reset\_profile}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{reset\_profile()}{reset\_profile()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_ad987a9aa9be0eecd1723fb065783291a} 
reset\+\_\+profile (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



This method resets the variables used for execution time profiling. 

This method is also used by {\ttfamily \doxylink{classcotask_1_1_task_a9c7e20ac92efc057ba6df6851adc45ba}{\+\_\+\+\_\+init\+\_\+\+\_\+()}} to create the variables. \Hypertarget{classcotask_1_1_task_a2ac9e615bfff6001c329e7cbaf58a84e}\index{Task@{Task}!schedule@{schedule}}
\index{schedule@{schedule}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{schedule()}{schedule()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_a2ac9e615bfff6001c329e7cbaf58a84e} 
 bool schedule (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



This method is called by the scheduler; it attempts to run this task. 

If the task is not yet ready to run, this method returns {\ttfamily False} immediately; if this task is ready to run, it runs the task\textquotesingle{}s generator up to the next {\ttfamily yield()} and then returns {\ttfamily True}.

\begin{DoxyReturn}{Returns}
{\ttfamily True} if the task ran or {\ttfamily False} if it did not 
\end{DoxyReturn}
\Hypertarget{classcotask_1_1_task_aabadc1d997c668994c8a8ed5783d3501}\index{Task@{Task}!set\_period@{set\_period}}
\index{set\_period@{set\_period}!Task@{Task}}
\doxysubsubsection{\texorpdfstring{set\_period()}{set\_period()}}
{\footnotesize\ttfamily \label{classcotask_1_1_task_aabadc1d997c668994c8a8ed5783d3501} 
set\+\_\+period (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{new\+\_\+period}{}\end{DoxyParamCaption})}



This method sets the period between runs of the task to the given number of milliseconds, or {\ttfamily None} if the task is triggered by calls to {\ttfamily \doxylink{classcotask_1_1_task_aed457c4e809216b219f54ededf51b6e1}{go()}} rather than time. 


\begin{DoxyParams}{Parameters}
{\em new\+\_\+period} & The new period in milliseconds between task runs \\
\hline
\end{DoxyParams}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{cotask_8py}{cotask.\+py}}\end{DoxyCompactItemize}
